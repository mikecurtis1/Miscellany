/* ------------------------------------------------------ */

USE `ids_movedb`;

/* ------------------------------------------------------ */

ALTER TABLE `test_prefixdbo_AlfredCeramics` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_AlfredUniversity` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Binghamton` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Brockport` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_BrooklynCollege` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_BroomeCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_BuffaloState` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_CUNYGraduateCenter` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_CityCollege` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_ClarksonUniversity` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Cobleskill` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_CollegeofStatenIsland` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_ColumbiaGreeneCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_CorningCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Cortland` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Delhi` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_ESF` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_ErieCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_FIT` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Fredonia` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_FultonMontgomeryCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_GeneseeCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Geneseo` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_HudsonValleyCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_HunterCollege` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_JeffersonCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_JohnJay` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_LaGuardiaCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Manhattanville` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Maritime` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_MonroeCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Morrisville` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_NYPL` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_NYSL` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Nazareth` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_NewPaltz` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_OldWestbury` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Oneonta` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_OrangeCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Oswego` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Plattsburgh` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Potsdam` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Purchase` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_SUNYIT` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_SchenectadyCountyCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_StRose` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_StonyBrook` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_StonyBrookHealthSciences` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_SullivanCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_Syracuse` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_TC3` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_UlsterCountyCC` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_UpstateMedical` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_UticaCollege` ADD `OCLCSymbol` VARCHAR(8);
ALTER TABLE `test_prefixdbo_VassarCollege` ADD `OCLCSymbol` VARCHAR(8);

/* ------------------------------------------------------ */

UPDATE `test_prefixdbo_AlfredCeramics` SET `OCLCSymbol` = 'YDM';
UPDATE `test_prefixdbo_AlfredUniversity` SET `OCLCSymbol` = 'YAH';
UPDATE `test_prefixdbo_Binghamton` SET `OCLCSymbol` = 'BNG';
UPDATE `test_prefixdbo_Brockport` SET `OCLCSymbol` = 'XBM';
UPDATE `test_prefixdbo_BrooklynCollege` SET `OCLCSymbol` = 'VDB';
UPDATE `test_prefixdbo_BroomeCC` SET `OCLCSymbol` = 'YSY';
UPDATE `test_prefixdbo_BuffaloState` SET `OCLCSymbol` = 'YBM';
UPDATE `test_prefixdbo_CUNYGraduateCenter` SET `OCLCSymbol` = 'ZGM';
UPDATE `test_prefixdbo_CityCollege` SET `OCLCSymbol` = 'ZXC';
UPDATE `test_prefixdbo_ClarksonUniversity` SET `OCLCSymbol` = 'VYT';
UPDATE `test_prefixdbo_Cobleskill` SET `OCLCSymbol` = 'WKM';
UPDATE `test_prefixdbo_CollegeofStatenIsland` SET `OCLCSymbol` = 'VSI';
UPDATE `test_prefixdbo_ColumbiaGreeneCC` SET `OCLCSymbol` = 'VDH';
UPDATE `test_prefixdbo_CorningCC` SET `OCLCSymbol` = 'ZDG';
UPDATE `test_prefixdbo_Cortland` SET `OCLCSymbol` = 'YCM';
UPDATE `test_prefixdbo_Delhi` SET `OCLCSymbol` = 'XDM';
UPDATE `test_prefixdbo_ESF` SET `OCLCSymbol` = 'VXF';
UPDATE `test_prefixdbo_ErieCC` SET `OCLCSymbol` = 'YJL';
UPDATE `test_prefixdbo_FIT` SET `OCLCSymbol` = 'UVV';
UPDATE `test_prefixdbo_Fredonia` SET `OCLCSymbol` = 'XFM';
UPDATE `test_prefixdbo_FultonMontgomeryCC` SET `OCLCSymbol` = 'YJM';
UPDATE `test_prefixdbo_GeneseeCC` SET `OCLCSymbol` = 'YJA';
UPDATE `test_prefixdbo_Geneseo` SET `OCLCSymbol` = 'YGM';
UPDATE `test_prefixdbo_HudsonValleyCC` SET `OCLCSymbol` = 'VXV';
UPDATE `test_prefixdbo_HunterCollege` SET `OCLCSymbol` = 'ZHM';
UPDATE `test_prefixdbo_JeffersonCC` SET `OCLCSymbol` = 'VND';
UPDATE `test_prefixdbo_JohnJay` SET `OCLCSymbol` = 'VVJ';
UPDATE `test_prefixdbo_LaGuardiaCC` SET `OCLCSymbol` = 'CTX';
UPDATE `test_prefixdbo_Manhattanville` SET `OCLCSymbol` = 'VYE';
UPDATE `test_prefixdbo_Maritime` SET `OCLCSymbol` = 'ZMM';
UPDATE `test_prefixdbo_MonroeCC` SET `OCLCSymbol` = 'VQT';
UPDATE `test_prefixdbo_Morrisville` SET `OCLCSymbol` = 'XMM';
UPDATE `test_prefixdbo_NYPL` SET `OCLCSymbol` = 'NYP';
UPDATE `test_prefixdbo_NYSL` SET `OCLCSymbol` = 'NYG';
UPDATE `test_prefixdbo_Nazareth` SET `OCLCSymbol` = 'XNC';
UPDATE `test_prefixdbo_NewPaltz` SET `OCLCSymbol` = 'ZLM';
UPDATE `test_prefixdbo_OldWestbury` SET `OCLCSymbol` = 'ZOW';
UPDATE `test_prefixdbo_Oneonta` SET `OCLCSymbol` = 'ZBM';
UPDATE `test_prefixdbo_OrangeCC` SET `OCLCSymbol` = 'VGA';
UPDATE `test_prefixdbo_Oswego` SET `OCLCSymbol` = 'YOM';
UPDATE `test_prefixdbo_Plattsburgh` SET `OCLCSymbol` = 'YPM';
UPDATE `test_prefixdbo_Potsdam` SET `OCLCSymbol` = 'ZQM';
UPDATE `test_prefixdbo_Purchase` SET `OCLCSymbol` = 'ZPM';
UPDATE `test_prefixdbo_SUNYIT` SET `OCLCSymbol` = 'YTM';
UPDATE `test_prefixdbo_SchenectadyCountyCC` SET `OCLCSymbol` = 'XJM';
UPDATE `test_prefixdbo_StRose` SET `OCLCSymbol` = 'VJN';
UPDATE `test_prefixdbo_StonyBrook` SET `OCLCSymbol` = 'YSM';
UPDATE `test_prefixdbo_StonyBrookHealthSciences` SET `OCLCSymbol` = 'VZB';
UPDATE `test_prefixdbo_SullivanCC` SET `OCLCSymbol` = 'VGK';
UPDATE `test_prefixdbo_Syracuse` SET `OCLCSymbol` = 'SYB';
UPDATE `test_prefixdbo_TC3` SET `OCLCSymbol` = 'VXT';
UPDATE `test_prefixdbo_UlsterCountyCC` SET `OCLCSymbol` = 'VGN';
UPDATE `test_prefixdbo_UpstateMedical` SET `OCLCSymbol` = 'VYQ';
UPDATE `test_prefixdbo_UticaCollege` SET `OCLCSymbol` = 'VVV';
UPDATE `test_prefixdbo_VassarCollege` SET `OCLCSymbol` = 'VXW';

/* ------------------------------------------------------ */

CREATE TABLE `transactions` LIKE `test_prefixdbo_VassarCollege`;

/* ------------------------------------------------------ */

INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_AlfredCeramics`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_AlfredUniversity`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Binghamton`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Brockport`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_BrooklynCollege`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_BroomeCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_BuffaloState`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_CUNYGraduateCenter`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_CityCollege`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_ClarksonUniversity`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Cobleskill`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_CollegeofStatenIsland`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_ColumbiaGreeneCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_CorningCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Cortland`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Delhi`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_ESF`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_ErieCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_FIT`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Fredonia`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_FultonMontgomeryCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_GeneseeCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Geneseo`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_HudsonValleyCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_HunterCollege`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_JeffersonCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_JohnJay`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_LaGuardiaCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Manhattanville`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Maritime`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_MonroeCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Morrisville`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_NYPL`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_NYSL`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Nazareth`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_NewPaltz`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_OldWestbury`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Oneonta`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_OrangeCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Oswego`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Plattsburgh`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Potsdam`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Purchase`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_SUNYIT`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_SchenectadyCountyCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_StRose`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_StonyBrook`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_StonyBrookHealthSciences`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_SullivanCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_Syracuse`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_TC3`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_UlsterCountyCC`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_UpstateMedical`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_UticaCollege`;
INSERT INTO `transactions` SELECT * FROM `test_prefixdbo_VassarCollege`;

/* ------------------------------------------------------ */

CREATE DATABASE `illiad`;

CREATE TABLE `illiad.transactions` LIKE `ids_movedb.transactions`;

INSERT INTO `illiad.transactions` SELECT * FROM `ids_movedb.transactions`;

/* ------------------------------------------------------ */

USE `illiad`;

ALTER TABLE `transactions` ADD `id` integer unsigned not null unique auto_increment FIRST;
ALTER TABLE `transactions` ADD COLUMN `NormalizedISSN` varchar(8) AFTER `ISSN`;
ALTER TABLE `transactions` ADD COLUMN `NormalizedISBN` varchar(13) AFTER `NormalizedISSN`;
ALTER TABLE `transactions` ADD COLUMN `NormalizedYear` varchar(4) AFTER `NormalizedISBN`;
ALTER TABLE `transactions` ADD COLUMN `TempYear` varchar(12) AFTER `NormalizedYear`;
ALTER TABLE `transactions` ADD COLUMN `NormalizedTitle` varchar(50) AFTER `NormalizedYear`

CREATE FULLTEXT INDEX `marc245` ON `items`(`marc245`)
CREATE INDEX `NormalizedISBN` ON `transactions`(`NormalizedISBN`)
CREATE FULLTEXT INDEX `NormalizedTitle` ON `transactions`(`NormalizedTitle`)

/* ------------------------------------------------------ */

/* run normalize.php to fill in NormalizedISSN, Normalized ISBN, and NormalizedYear */

/* ------------------------------------------------------ */

UPDATE `transactions` t, `items` i SET t.`NormalizedTitle` = i.`marc245` WHERE t.`NormalizedISBN` = i.`item_id`

UPDATE `transactions` t, `items` i SET t.`TempYear` = i.`marc260c` WHERE t.`NormalizedISBN` = i.`item_id`

